
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Device interface &#8212; CPP VSM SDK  documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.ee6fb81b276d6fba8a971ad8e9b95dd9.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="_static/js/index.c86189f1ce1b71a67eb6.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/target-highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Asynchronous programming framework" href="page_async_programming_page.html" />
    <link rel="prev" title="Manual" href="page_ucs_vsm_manual_page.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="index.html">
  <img src="_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="page_ucs_vsm_overview_page.html">
  Overview
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="page_getting_started.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="page_ucs_vsm_manual_page.html">
  Manual
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="page_tutorials_page.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="page_license_page.html">
  License
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="global.html">
  Global Namespace
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://www.ugcs.com/">UgCS<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ugcs/vsm-cpp-sdk" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Device interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="page_async_programming_page.html">
   Asynchronous programming framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="page_service_discovery_page.html">
   Automatic Service Discovery
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="page_ucs_vsm_protocol_page.html">
   UCS-VSM communications protocol
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_proto_page.html">
     ucs_vsm.proto
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_overview_page.html">
     Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_registration_page.html">
     Vehicle registration with UCS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_fields_page.html">
     Field types and semantics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_telemetry_page.html">
     Telemetry protocol
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_commands_page.html">
     UCS-VSM Commands
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_protocol_examples_page.html">
     UCS-VSM protocol example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="page_ucs_vsm_protocol_wire_format_page.html">
     UCS-VSM protocol wire format
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#brief">
   Brief
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creation">
   Creation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deletion">
   Deletion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#telemetry">
   Telemetry
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vehicle-commands">
   Vehicle commands
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="device-interface">
<span id="doxid-da-d5e-vehicle-interface-page"></span><span id="index-0"></span><h1>Device interface<a class="headerlink" href="#device-interface" title="Permalink to this headline">¶</a></h1>
<div class="section" id="brief">
<span id="doxid-da-d5e-vehicle-interface-page-1brief"></span><h2>Brief<a class="headerlink" href="#brief" title="Permalink to this headline">¶</a></h2>
<p>Device interface is the main concept to be used by VSM developer to add custom devices to UgCS. The interface itself is represented by a base class <a class="reference internal" href="class_ugcs_vsm_Device.html#doxid-d1-dfa-classugcs-1-1vsm-1-1-device"><span class="std std-ref">ugcs::vsm::Device</span></a> which should be inherited to implement specific device types. For example:</p>
<pre class="highlight literal-block"><span></span><span class="k">class</span> <span class="nl">Custom_vehicle</span><span class="p">:</span><span class="k">public</span> <a class="reference internal" href="class_ugcs_vsm_Device.html#doxid-d1-dfa-classugcs-1-1vsm-1-1-device"><span class="std std-ref">ugcs::vsm::Device</span></a><span></span>
<span class="p">{</span>
    <span class="cm">/* To add shared pointer capability to this class. */</span>
    <a class="reference internal" href="global.html#doxid-d5-d60-utils-8h-1add7ad4e26c0e697e6eadb8da66c3e60d"><span class="std std-ref">DEFINE_COMMON_CLASS</span></a><span></span><span class="p">(</span><span class="n">Custom_vehicle</span><span class="p">,</span> <a class="reference internal" href="class_ugcs_vsm_Device.html#doxid-d1-dfa-classugcs-1-1vsm-1-1-device"><span class="std std-ref">ugcs::vsm::Device</span></a><span></span><span class="p">)</span></pre>
<p>As a result, new class denotes a specific vehicle type which can interact with UgCS. Separate instance of this class should be created for each physical vehicle connected to the VSM application. That is, if there are two vehicles of the same type which should be simultaneously managed by UgCS, two class instances should be created (see <a class="reference internal" href="#doxid-da-d5e-vehicle-interface-page-1instance-creation"><span class="std std-ref">Creation</span></a>).</p>
<p>UgCS is a distributed system with multiple VSM applications and each vehicle is globally identified by a unique combination of case sensitive <em>vehicle_name</em> and <em>serial_number</em> string values. They are used in overloaded Fill_register_msg method and can not be changed during vehicle class instance lifetime. Same model name and serial number values in different VSM applications denotes the same physical vehicle. It is up to VSM application developer to identify physical vehicles and their model names and serial numbers. The exact content of model name and serial number is not enforced, however it is recommended to provide some human readable values, for example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="nl">name</span><span class="p">:</span> <span class="n">Arducopter</span>
<span class="n">Serial</span> <span class="nl">number</span><span class="p">:</span> <span class="mi">1</span>

<span class="n">Model</span> <span class="nl">name</span><span class="p">:</span> <span class="n">MD4</span><span class="o">-</span><span class="mi">200</span>
<span class="n">Serial</span> <span class="nl">number</span><span class="p">:</span> <span class="mi">12345</span>
</pre></div>
</div>
<p>If there is absolutely no technical way to identify a vehicle using vehicle specific protocol, a mapping from physical communication port/interface to vehicle may be used, for example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Serial</span> <span class="nl">COM1</span><span class="p">:</span> <span class="n">Vehicle</span> <span class="mi">1</span>
<span class="n">Serial</span> <span class="nl">COM2</span><span class="p">:</span> <span class="n">Vehicle</span> <span class="mi">2</span>
<span class="n">WiFi</span> <span class="nl">network</span><span class="p">:</span> <span class="n">Vehicle</span> <span class="mi">3</span>
<span class="n">USB</span> <span class="nl">device</span><span class="p">:</span> <span class="n">Vehicle</span> <span class="mi">4</span>
</pre></div>
</div>
<p>In this case, end-user of the UgCS should be informed about such mapping.</p>
<p>Vehicle and autopilot types should be also set in ugcs::vsm::Device::Fill_register_msg(). This is to inform UgCS about the features supported by a particular vehicle. The support for additional features is specified by registering commands and telemetry fields. See also <a class="reference internal" href="#doxid-da-d5e-vehicle-interface-page-1telemetry"><span class="std std-ref">Telemetry</span></a> and commands.</p>
<p>By default, all device instances are created with a dedicated thread to facilitate parallelization of multi-vehicle VSM applications and safeguard from one vehicle affecting another. See <a class="reference internal" href="class_ugcs_vsm_Device.html#doxid-d1-dfa-classugcs-1-1vsm-1-1-device-1a1eb709bfab445c201058086c0808b387"><span class="std std-ref">ugcs::vsm::Device::Device</span></a> and <a class="reference internal" href="page_async_programming_page.html#doxid-d4-da8-async-programming-page"><span class="std std-ref">Asynchronous programming framework</span></a>.</p>
</div>
<div class="section" id="creation">
<span id="doxid-da-d5e-vehicle-interface-page-1instance-creation"></span><h2>Creation<a class="headerlink" href="#creation" title="Permalink to this headline">¶</a></h2>
<p>As a general rule, the instance of specific vehicle class is created when physical vehicle is connected to VSM and identified (model name and serial number) or some specific vehicle is predefined and VSM is awaiting its connection. Creation is done as follows:</p>
<pre class="highlight literal-block"><span></span><span class="cm">/* Create vehicle instance with hard-coded serial number. */</span>
<span class="n">Custom_vehicle</span><span class="o">::</span><span class="n">Ptr</span> <span class="n">vehicle</span> <span class="o">=</span> <span class="n">Custom_vehicle</span><span class="o">::</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;asd123456&quot;</span><span class="p">);</span></pre>
<p>Right after the instance is created, it should be enabled by calling <a class="reference internal" href="class_ugcs_vsm_Device.html#doxid-d1-dfa-classugcs-1-1vsm-1-1-device-1a6d1d13dd8ae61480c6a063b6e085d844"><span class="std std-ref">ugcs::vsm::Device::Enable</span></a> method. It is necessary to complete additional low level initialization actions which are not possible to implement in class constructor, for example, to use shared pointer to the class instance which is being created. Derived vehicle class may override <span class="xref std std-ref">ugcs::vsm::Device::On_enable()</span> method to implement vehicle class specific initializations. This initialization is not expected to fail. Vehicle instance should be ready to accept vehicle requests (see <a class="reference internal" href="#doxid-da-d5e-vehicle-interface-page-1vehicle-requests-section"><span class="std std-ref">Vehicle commands</span></a>) right after <span class="xref std std-ref">ugcs::vsm::Device::On_enable()</span> method is completed. See also <a class="reference internal" href="#doxid-da-d5e-vehicle-interface-page-1instance-deletion"><span class="std std-ref">Deletion</span></a>.</p>
</div>
<div class="section" id="deletion">
<span id="doxid-da-d5e-vehicle-interface-page-1instance-deletion"></span><h2>Deletion<a class="headerlink" href="#deletion" title="Permalink to this headline">¶</a></h2>
<p>Class instance deletion (i.e. memory releasing) happens automatically thanks to shared pointer usage, but before releasing the last reference to instance pointer, <a class="reference internal" href="class_ugcs_vsm_Device.html#doxid-d1-dfa-classugcs-1-1vsm-1-1-device-1a2fc5001dbdeaa3e47fd988c203c3a166"><span class="std std-ref">ugcs::vsm::Device::Disable()</span></a> method should be called to perform finalization and cleanup actions like breaking of shared pointer circular dependencies:</p>
<pre class="highlight literal-block"><span></span><span class="cm">/* Disable the vehicle, considered to be deleted after that. */</span>
<span class="n">vehicle</span><span class="o">-&gt;</span><span class="n">Disable</span><span class="p">();</span></pre>
<p>Derived vehicle class may override <span class="xref std std-ref">ugcs::vsm::Device::On_disable()</span> method to implement vehicle class specific finalization.</p>
</div>
<div class="section" id="telemetry">
<span id="doxid-da-d5e-vehicle-interface-page-1telemetry"></span><h2>Telemetry<a class="headerlink" href="#telemetry" title="Permalink to this headline">¶</a></h2>
<p>Vehicle can define and use arbitrary set of telemetry fileds with different types. Supported telemetry fields are registered in ugcs::vsm::Device::Fill_register_msg(). Telemetry is updated by setting new value via <a class="reference internal" href="class_ugcs_vsm_Property.html#doxid-d2-d7c-classugcs-1-1vsm-1-1-property-1a391bf8c307181dacf8cc796a5131ec07"><span class="std std-ref">ugcs::vsm::Property::Set_value()</span></a> call. All updated values are sent to UgCS via <span class="xref std std-ref">ugcs::vsm::Device::Commit_to_ucs()</span> call. It is up to VSM application developer to decide about the frequency of telemetry reports generation.</p>
<p>Example:</p>
<pre class="highlight literal-block"><span></span><span class="kt">bool</span>
<span class="nf">Send_telemetry</span><span class="p">()</span>
<span class="p">{</span>

    <span class="cm">/* Report current heading. */</span>
    <span class="n">t_heading</span><span class="o">-&gt;</span><span class="n">Set_value</span><span class="p">(</span><span class="n">yaw</span><span class="p">);</span>

    <span class="cm">/* Simulate some spinning between [-Pi;+Pi]. */</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">yaw</span> <span class="o">+=</span> <span class="n">yaw_speed</span><span class="p">)</span> <span class="o">&gt;=</span> <a class="reference internal" href="global.html#doxid-df-db1-math-8h-1ae71449b1cc6e6250b91f539153a7a0d3"><span class="std std-ref">M_PI</span></a><span></span><span class="p">)</span> <span class="p">{</span>
        <span class="n">yaw</span> <span class="o">=</span> <span class="o">-</span><a class="reference internal" href="global.html#doxid-df-db1-math-8h-1ae71449b1cc6e6250b91f539153a7a0d3"><span class="std std-ref">M_PI</span></a><span></span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Simulate climbing high to the sky. */</span>
    <span class="n">altitude</span> <span class="o">+=</span> <span class="n">climb_speed</span><span class="p">;</span>
    <span class="n">t_altitude_raw</span><span class="o">-&gt;</span><span class="n">Set_value</span><span class="p">(</span><span class="n">altitude</span><span class="p">);</span>

    <span class="cm">/* Report also some battery value. */</span>
    <span class="n">t_main_voltage</span><span class="o">-&gt;</span><span class="n">Set_value</span><span class="p">(</span><span class="mf">13.5</span><span class="p">);</span>

    <span class="cm">/* Enable ARM command if vehicle is disarmed. */</span>
    <span class="n">c_arm</span><span class="o">-&gt;</span><span class="n">Set_enabled</span><span class="p">(</span><span class="o">!</span><span class="n">is_armed</span><span class="p">);</span>

    <span class="cm">/* Enable DISARM command if vehicle is armed. */</span>
    <span class="n">c_disarm</span><span class="o">-&gt;</span><span class="n">Set_enabled</span><span class="p">(</span><span class="n">is_armed</span><span class="p">);</span>

    <span class="cm">/* Report armed state to the UgCS */</span>
    <span class="n">t_is_armed</span><span class="o">-&gt;</span><span class="n">Set_value</span><span class="p">(</span><span class="n">is_armed</span><span class="p">);</span>

    <span class="cm">/* Send the updated telemetry fields and command states to UgCS</span>
<span class="cm">     * SDK will send only modified values thus saving bandwidth */</span>
    <span class="n">Commit_to_ucs</span><span class="p">();</span>

    <a class="reference internal" href="global.html#doxid-d7-d7f-log-8h-1a159ca84d25a5487d8e81e4438725df19"><span class="std std-ref">LOG</span></a><span></span><span class="p">(</span><span class="s">&quot;send tm&quot;</span><span class="p">);</span>
    <span class="cm">/* Return true to reschedule the same timer again. */</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span></pre>
<p>See <a class="reference internal" href="page_ucs_vsm_telemetry_page.html#doxid-de-d20-ucs-vsm-telemetry-page"><span class="std std-ref">Telemetry protocol</span></a> for the description of all built-in telemetry parameters. Reported subset of telemetry parameters depends on capabilities of a specific vehicle and is controlled by VSM application developer.</p>
</div>
<div class="section" id="vehicle-commands">
<span id="doxid-da-d5e-vehicle-interface-page-1vehicle-requests-section"></span><h2>Vehicle commands<a class="headerlink" href="#vehicle-commands" title="Permalink to this headline">¶</a></h2>
<p>UgCS controls vehicles by sending command requests to them, which in turn should be processed by the vehicle and result is reported back to UgCS. All supported vehicle commands should be registered in the overloaded Fill_register_msg() method. When Vehicle receives command the overloaded method Handle_ucs_command() is called. The processing of a request can be done asynchronously by storing the handle and returning from Handle_ucs_command() method. VSM could implement multiple commands in parralel if vehicle supports it.</p>
<p>The raw payload of vehicle request can be accessed via Ucs_request::request and response can be accessed via Ucs_request::response. The response will be sent back to the UgCS once Ucs_request::Complete() is called.</p>
<p>See <a class="reference internal" href="page_hello_world_vsm_page.html#doxid-d8-db6-hello-world-vsm-page"><span class="std std-ref">“Hello world” VSM application</span></a> tutorial for examples of vehicle requests usage.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="page_ucs_vsm_manual_page.html" title="previous page">Manual</a>
    <a class='right-next' id="next-link" href="page_async_programming_page.html" title="next page">Asynchronous programming framework</a>

              </div>
              
          </main>
          

      </div>
    </div>
    
  <script src="_static/js/index.c86189f1ce1b71a67eb6.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, SPH Engineering.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>