

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>class ugcs::vsm::internal::Poll_io_controller &#8212; CPP VSM SDK  documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/target-highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="struct ugcs::vsm::internal::Poll_io_controller::Io_cb" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html" />
    <link rel="prev" title="class ugcs::vsm::internal::Overlapped_io_controller" href="class_ugcs_vsm_internal_Overlapped_io_controller.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="index.html">
      <img src="_static/logo.png" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="page_ucs_vsm_overview_page.html">Overview</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_getting_started.html">Getting Started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_ucs_vsm_manual_page.html">Manual</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_tutorials_page.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_license_page.html">License</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="examples.html">Examples</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="global.html">Global Namespace</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://www.ugcs.com/">UgCS<i class="fas fa-external-link-alt"></i></a>
        </li>
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/ugcs/vsm-cpp-sdk" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
          
              <li class="">
                  <a href="namespace_std.html">namespace std</a>
              </li>
          
        
          

              <li class="active">
                  <a href="namespace_ugcs.html">namespace ugcs</a>
                  <ul>
                  
                      <li class="active">
                          <a href="namespace_ugcs_vsm.html">namespace ugcs::vsm</a>
                      </li>
                  
                  </ul>
              </li>
          
        
          
              <li class="">
                  <a href="struct_glob_t.html">struct glob_t</a>
              </li>
          
        
          
              <li class="">
                  <a href="class_Adsb_vehicle.html">class Adsb_vehicle</a>
              </li>
          
        
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#overview" class="nav-link">Overview</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#inherited-members" class="nav-link">Inherited Members</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#detailed-documentation" class="nav-link">Detailed Documentation</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#methods" class="nav-link">Methods</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="class-ugcs-vsm-internal-poll-io-controller">
<span id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller"></span><span id="index-0"></span><h1>class ugcs::vsm::internal::Poll_io_controller<a class="headerlink" href="#class-ugcs-vsm-internal-poll-io-controller" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Linux-specific implementation for I/O controller. <a class="reference internal" href="#details-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller"><span class="std std-ref">More…</span></a></p>
<pre class="highlight doxyrest-overview-code-block literal-block"><span></span><span class="cp">#include</span> <span class="cpf">&lt;poll_io_controller.h&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="nl">Poll_io_controller</span><span class="p">:</span> <span class="k">public</span> <a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller"><span class="std std-ref">ugcs::vsm::File_processor::Native_controller</span></a><span></span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="c1">// structs</span>

    <span class="k">struct</span> <a class="reference internal" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html#doxid-dd-dbb-structugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-io-cb"><span class="std std-ref">Io_cb</span></a><span></span><span class="p">;</span>

    <span class="c1">// classes</span>

    <span class="k">class</span> <a class="reference internal" href="class_ugcs_vsm_internal_Poll_io_controller_File_desc.html#doxid-d6-d61-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-file-desc"><span class="std std-ref">File_desc</span></a><span></span><span class="p">;</span>

    <span class="c1">// methods</span>

    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a3ec2f490e4db51c486784876a0044b28"><span class="std std-ref">Enable</span></a><span></span><span class="p">();</span>
    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a017cfadfa8a801fc0d384f44f767b0c4"><span class="std std-ref">Disable</span></a><span></span><span class="p">();</span>
    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1afa6b87e26214420cad84428ba843fce8"><span class="std std-ref">Register_handle</span></a><span></span><span class="p">(</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Stream_Native_handle.html#doxid-d2-dda-classugcs-1-1vsm-1-1-file-processor-1-1-stream-1-1-native-handle"><span class="std std-ref">File_processor::Stream::Native_handle</span></a><span></span><span class="o">&amp;</span><span class="p">);</span>
    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a07748977e236894f5fa8695d5795755b"><span class="std std-ref">Unregister_handle</span></a><span></span><span class="p">(</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Stream_Native_handle.html#doxid-d2-dda-classugcs-1-1vsm-1-1-file-processor-1-1-stream-1-1-native-handle"><span class="std std-ref">File_processor::Stream::Native_handle</span></a><span></span><span class="o">&amp;</span><span class="p">);</span>
    <span class="kt">void</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a86a9cea56cd94bd0b63277421baaa8af"><span class="std std-ref">Delete_handle</span></a><span></span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>
    <span class="kt">bool</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a201c8654b679c09bc96ce27e03e538d8"><span class="std std-ref">Queue_operation</span></a><span></span><span class="p">(</span><a class="reference internal" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html#doxid-dd-dbb-structugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-io-cb"><span class="std std-ref">Io_cb</span></a><span></span><span class="o">&amp;</span> <span class="n">io_cb</span><span class="p">);</span>
    <span class="kt">bool</span> <a class="reference internal" href="#doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1ad2b957e2ff0553be14364dc9a8b62644"><span class="std std-ref">Cancel_operation</span></a><span></span><span class="p">(</span><a class="reference internal" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html#doxid-dd-dbb-structugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-io-cb"><span class="std std-ref">Io_cb</span></a><span></span><span class="o">&amp;</span> <span class="n">io_cb</span><span class="p">);</span>
<span class="p">};</span></pre>
<div class="section" id="inherited-members">
<h3>Inherited Members<a class="headerlink" href="#inherited-members" title="Permalink to this headline">¶</a></h3>
<pre class="highlight doxyrest-overview-inherited-code-block literal-block"><span></span><span class="k">public</span><span class="o">:</span>
    <span class="c1">// methods</span>

    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller-1adef24f99b91c2b8e334b109b3dbd4f9d"><span class="std std-ref">Enable</span></a><span></span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller-1af8279aabc8eac87eb7f9c20c41e5c0a6"><span class="std std-ref">Disable</span></a><span></span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller-1acb77d1182559fcf8d8bffe9eb32b2f8c"><span class="std std-ref">Register_handle</span></a><span></span><span class="p">(</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Stream_Native_handle.html#doxid-d2-dda-classugcs-1-1vsm-1-1-file-processor-1-1-stream-1-1-native-handle"><span class="std std-ref">Stream::Native_handle</span></a><span></span><span class="o">&amp;</span> <span class="n">handle</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller-1a663897a4c5853bba28b45e4d39a79ee2"><span class="std std-ref">Unregister_handle</span></a><span></span><span class="p">(</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Stream_Native_handle.html#doxid-d2-dda-classugcs-1-1vsm-1-1-file-processor-1-1-stream-1-1-native-handle"><span class="std std-ref">Stream::Native_handle</span></a><span></span><span class="o">&amp;</span> <span class="n">handle</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller"><span class="std std-ref">Native_controller</span></a><span></span><span class="o">&gt;</span> <a class="reference internal" href="class_ugcs_vsm_File_processor_Native_controller.html#doxid-d4-d55-classugcs-1-1vsm-1-1-file-processor-1-1-native-controller-1a114967e059329ae40f425cf0d9d7992a"><span class="std std-ref">Create</span></a><span></span><span class="p">();</span></pre>
</div>
</div>
<div class="section" id="detailed-documentation">
<span id="details-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller"></span><h2>Detailed Documentation<a class="headerlink" href="#detailed-documentation" title="Permalink to this headline">¶</a></h2>
<p>Linux-specific implementation for I/O controller.</p>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a3ec2f490e4db51c486784876a0044b28"><span id="index-1"></span><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">Enable</span><span class="p">()</span></pre>
<p>Enable the controller.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a017cfadfa8a801fc0d384f44f767b0c4"><span id="index-2"></span><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">Disable</span><span class="p">()</span></pre>
<p>Disable the controller.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1afa6b87e26214420cad84428ba843fce8"><span id="index-3"></span><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">Register_handle</span><span class="p">(</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Stream_Native_handle.html#doxid-d2-dda-classugcs-1-1vsm-1-1-file-processor-1-1-stream-1-1-native-handle"><span class="std std-ref">File_processor::Stream::Native_handle</span></a><span></span><span class="o">&amp;</span><span class="p">)</span></pre>
<p>Register new opened file handle.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a07748977e236894f5fa8695d5795755b"><span id="index-4"></span><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">Unregister_handle</span><span class="p">(</span><a class="reference internal" href="class_ugcs_vsm_File_processor_Stream_Native_handle.html#doxid-d2-dda-classugcs-1-1vsm-1-1-file-processor-1-1-stream-1-1-native-handle"><span class="std std-ref">File_processor::Stream::Native_handle</span></a><span></span><span class="o">&amp;</span><span class="p">)</span></pre>
<p>Unregister previously registered file handle.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a86a9cea56cd94bd0b63277421baaa8af"><span id="index-5"></span><span></span><span class="kt">void</span> <span class="n">Delete_handle</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">)</span></pre>
<p>Delete handle.</p>
<p>Possibly deferred. This is a workaround of kernel panic bug in OSX. The scenario: 1) create pipe with descriptors p1, p2. 2) open serial port with descriptor fd. 3) poll on two descriptors p1 and fd in separate thread. 4) issue write on p2. This triggers read event on p1 and wakes up poll(). 5) close(fd)</p>
<p>Results:</p>
<ul class="simple">
<li><p>When (4) and (5) are close enough poll does not wake up and close(fd) blocks and triggers kernel panic. This does not happen 100% of time but if the above code is put into loop it takes ~20-100 iterations to trigger.</p></li>
<li><p>When (4) and (5) are &gt;10ms apart the poll wakes up and close succeeds.</p></li>
<li><p>If close(fd) is called before write(p2) then I could not repeat the kernel panic. Solution:</p></li>
</ul>
<p>Do not close the fd while it is in polling state. Close it after poll returns.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1a201c8654b679c09bc96ce27e03e538d8"><span id="index-6"></span><span></span><span class="kt">bool</span> <span class="n">Queue_operation</span><span class="p">(</span><a class="reference internal" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html#doxid-dd-dbb-structugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-io-cb"><span class="std std-ref">Io_cb</span></a><span></span><span class="o">&amp;</span> <span class="n">io_cb</span><span class="p">)</span></pre>
<p>Queue IO operation.</p>
<p>The provided callback is called when the operation completes with <a class="reference internal" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html#doxid-dd-dbb-structugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-io-cb"><span class="std std-ref">Io_cb</span></a> structure filled.</p>
<p class="rubric">Returns:</p>
<p>True if succeeded, false otherwise. Check errno for error code.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d2-db0-classugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1ad2b957e2ff0553be14364dc9a8b62644"><span id="index-7"></span><span></span><span class="kt">bool</span> <span class="n">Cancel_operation</span><span class="p">(</span><a class="reference internal" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html#doxid-dd-dbb-structugcs-1-1vsm-1-1internal-1-1-poll-io-controller-1-1-io-cb"><span class="std std-ref">Io_cb</span></a><span></span><span class="o">&amp;</span> <span class="n">io_cb</span><span class="p">)</span></pre>
<p>Cancel pending operation.</p>
<p class="rubric">Parameters:</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>io_cb</p></td>
<td><p>Operation control block.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Returns:</p>
<p>True if cancelled, false if not cancelled (e.g. too late).</p>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="class_ugcs_vsm_internal_Overlapped_io_controller.html" title="previous page">class ugcs::vsm::internal::Overlapped_io_controller</a>
    <a class='right-next' id="next-link" href="struct_ugcs_vsm_internal_Poll_io_controller_Io_cb.html" title="next page">struct ugcs::vsm::internal::Poll_io_controller::Io_cb</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, SPH Engineering.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>