
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Automatic Service Discovery &#8212; CPP VSM SDK  documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/target-highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="UCS-VSM communications protocol" href="page_ucs_vsm_protocol_page.html" />
    <link rel="prev" title="Asynchronous programming framework" href="page_async_programming_page.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <img src="_static/logo.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="page_ucs_vsm_overview_page.html">Overview</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_getting_started.html">Getting Started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="page_ucs_vsm_manual_page.html">Manual</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_tutorials_page.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="page_license_page.html">License</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="examples.html">Examples</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="global.html">Global Namespace</a>
        </li>
        
        
        <li class="nav-item">
            <a class="nav-link nav-external" href="https://www.ugcs.com/">UgCS<i class="fas fa-external-link-alt"></i></a>
        </li>
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/ugcs/vsm-cpp-sdk" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
          
            
                <li class="">
                    <a href="page_vehicle_interface_page.html">Device interface</a>
                </li>
            
          
            
                <li class="">
                    <a href="page_async_programming_page.html">Asynchronous programming framework</a>
                </li>
            
          
            
                <li class="active">
                    <a href="">Automatic Service Discovery</a>
                </li>
            
          
            
                <li class="">
                    <a href="page_ucs_vsm_protocol_page.html">UCS-VSM communications protocol</a>
                </li>
            
          
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#protocol-description" class="nav-link">Protocol Description</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#service-discovery-support-in-sdk" class="nav-link">Service discovery support in SDK</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#service-discovery-related-vsm-conf-file-parameters" class="nav-link">Service discovery related vsm.conf file parameters</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="automatic-service-discovery">
<span id="doxid-d0-d17-service-discovery-page"></span><span id="index-0"></span><h1>Automatic Service Discovery<a class="headerlink" href="#automatic-service-discovery" title="Permalink to this headline">¶</a></h1>
<p>Automatic Service Discovery feature enables possibility to discover VSMs in case UgCS server and VSM is using dynamic addresses. Used SSDP protocol (<a class="reference external" href="https://tools.ietf.org/html/draft-cai-ssdp-v1-03">https://tools.ietf.org/html/draft-cai-ssdp-v1-03</a>) as basis and actual data from packet captures when Windows and iOS searches for various stuff on my LAN.</p>
<div class="section" id="protocol-description">
<span id="doxid-d0-d17-service-discovery-page-1decription"></span><h2>Protocol Description<a class="headerlink" href="#protocol-description" title="Permalink to this headline">¶</a></h2>
<p>There are three messages invloved. They are HTTP messages without body, formatted according to HTTP specs, rfc7230.</p>
<ol class="arabic">
<li><p>Search. Issued by locator (UgCS server, in our case) on all interfaces using multicast address 239.198.46.46 to locate the requested service by type (ST). For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">M</span><span class="o">-</span><span class="n">SEARCH</span> <span class="o">*</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host</span><span class="p">:</span> <span class="mf">239.198.46.46</span><span class="o">:</span><span class="mi">1900</span>
<span class="nl">Man</span><span class="p">:</span> <span class="s">&quot;ssdp:discover&quot;</span>
<span class="nl">ST</span><span class="p">:</span> <span class="nl">ugcs</span><span class="p">:</span><span class="nl">vsm</span><span class="p">:</span><span class="n">ardupilot</span>
<span class="nl">MX</span><span class="p">:</span> <span class="mi">3</span>
</pre></div>
</div>
</li>
<li><p>Response to search. Sent by service as a response to M-SEARCH. Unicast. Contains service type (ST), unique service name (USN) and location (Location). For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="nl">ST</span><span class="p">:</span> <span class="nl">ugcs</span><span class="p">:</span><span class="nl">vsm</span><span class="p">:</span><span class="n">ardupilot</span>
<span class="nl">USN</span><span class="p">:</span> <span class="n">Ardupilot</span> <span class="n">VSM</span>
<span class="nl">Location</span><span class="p">:</span> <span class="mf">192.168.1.33</span><span class="o">:</span><span class="mi">5556</span>
<span class="nl">ID</span><span class="p">:</span> <span class="mi">12345678</span>
</pre></div>
</div>
</li>
<li><p>Notification. Sent by service when it becomes available. Multicast. Contains service type (NT), unique service name (USN) and location (Location). For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NOTIFY</span> <span class="o">*</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="nl">Host</span><span class="p">:</span> <span class="mf">239.198.46.46</span><span class="o">:</span><span class="mi">1900</span>
<span class="nl">NT</span><span class="p">:</span> <span class="nl">ugcs</span><span class="p">:</span><span class="nl">vsm</span><span class="p">:</span><span class="n">ardupilot</span>
<span class="nl">NTS</span><span class="p">:</span> <span class="nl">ssdp</span><span class="p">:</span><span class="n">alive</span>
<span class="nl">USN</span><span class="p">:</span> <span class="n">Ardupilot</span> <span class="n">VSM</span>
<span class="nl">Location</span><span class="p">:</span> <span class="mf">192.168.1.33</span><span class="o">:</span><span class="mi">5556</span>
<span class="nl">ID</span><span class="p">:</span> <span class="mi">12345678</span>
</pre></div>
</div>
</li>
</ol>
<p>There is a field “ID” added to the response and notify message. It specifies the service instance. Service client can use the ID field to distinguish between several locations of the same service instance to avoud multiple simultaneous connections. The ID is randomly generated on VSM startup and does change with each restart.</p>
</div>
<div class="section" id="service-discovery-support-in-sdk">
<span id="doxid-d0-d17-service-discovery-page-1sdk-support"></span><h2>Service discovery support in SDK<a class="headerlink" href="#service-discovery-support-in-sdk" title="Permalink to this headline">¶</a></h2>
<p>VSM SDK has support of automatic service discovery based on the above protocol.</p>
<p>Both ends are implemented in SDK, so developer can create both service advertisers and service locators with minimal effort. Five functions provide interface to service discovery protocol:</p>
<table class="table">
<colgroup>
<col style="width: 4%" />
<col style="width: 96%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td></td>
</tr>
</tbody>
</table>
<p>See file <code class="docutils literal notranslate"><span class="pre">service_discovery_processor.h</span></code> for details.</p>
<p>Service advertise support is already enabled by default and can be used by any VSM by adding lines to vsm.conf file.</p>
</div>
<div class="section" id="service-discovery-related-vsm-conf-file-parameters">
<span id="doxid-d0-d17-service-discovery-page-1conf-file"></span><h2>Service discovery related vsm.conf file parameters<a class="headerlink" href="#service-discovery-related-vsm-conf-file-parameters" title="Permalink to this headline">¶</a></h2>
<p>All parameters are optional: ===================================================  ============================================================================================================================================================================================================================================================================
Parameter name                                       Description
===================================================  ============================================================================================================================================================================================================================================================================
service_discovery.address                            Multicast IP address which is used as destination address when sending out M_SEARCH and NOTIFY messages. Default: 239.198.46.46
service_discovery.port                               UDP port on which service discovery protocol will listen. Default: 1991
service_discovery.advertise.[&lt;service_id&gt;.]name      Service name.
service_discovery.advertise.[&lt;service_id&gt;.]type      Type of service. This is the string by which the services are located. Type is case sensitive.
service_discovery.advertise.[&lt;service_id&gt;.]location  URI of service. Location in form: &lt;protocol&gt;://&lt;host&gt;:&lt;port&gt; where host can be ip address or dns name. Host can be replaced by special token “{local_address}”. It will be replaced by IP of the local interface when sending out search response packets or NOTIFY packets.
service_discovery.vsm_name                           Automatically enables VSM dicovery on specified port (
===================================================  ============================================================================================================================================================================================================================================================================</p>
<p>The parameteer <em>service_discovery.vsm_name</em> can be used to easily enable service discovery with default values.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">service_discovery</span><span class="p">.</span><span class="n">vsm_name</span> <span class="o">=</span> <span class="n">Ardupilot</span> <span class="n">VSM</span>
</pre></div>
</div>
<p>The above line is equivalent of the following config:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">service_discovery</span><span class="p">.</span><span class="n">advertise</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">Ardupilot</span> <span class="n">VSM</span>
<span class="n">service_discovery</span><span class="p">.</span><span class="n">advertise</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="nl">ugcs</span><span class="p">:</span><span class="n">vsm</span>
<span class="n">service_discovery</span><span class="p">.</span><span class="n">advertise</span><span class="p">.</span><span class="n">location</span> <span class="o">=</span> <span class="nl">tcp</span><span class="p">:</span><span class="c1">//{local_address}:&lt;value of ucs.local_listening_port parameter&gt;</span>
</pre></div>
</div>
<p>Example vsm.conf:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">service_discovery</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="mf">239.198.46.46</span>
<span class="n">service_discovery</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">1991</span>
<span class="n">service_discovery</span><span class="p">.</span><span class="n">advertise</span><span class="mf">.1</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">Ardupilot</span> <span class="n">VSM</span>
<span class="n">service_discovery</span><span class="p">.</span><span class="n">advertise</span><span class="mf">.1</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="nl">ugcs</span><span class="p">:</span><span class="n">vsm</span>
<span class="n">service_discovery</span><span class="p">.</span><span class="n">advertise</span><span class="mf">.1</span><span class="p">.</span><span class="n">location</span> <span class="o">=</span> <span class="nl">tcp</span><span class="p">:</span><span class="c1">//{local_address}:5556</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="page_async_programming_page.html" title="previous page">Asynchronous programming framework</a>
    <a class='right-next' id="next-link" href="page_ucs_vsm_protocol_page.html" title="next page">UCS-VSM communications protocol</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, SPH Engineering.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>